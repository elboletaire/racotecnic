<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Unir ficheros mp3 en un único fichero mp3 con CakePHP &#8211; Racó Tècnic</title>
<meta name="description" content="Punt de trobada de coneixements">
<meta name="keywords" content="CakePHP, ID3, getID3, mp3, CakePHP 1.1, CakePHP 1.3, CakePHP 1.2">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="//elboletaire.github.io/racotecnic/images/">
<meta name="twitter:title" content="Unir ficheros mp3 en un único fichero mp3 con CakePHP">
<meta name="twitter:description" content="Punt de trobada de coneixements">
<meta name="twitter:creator" content="@racotecnic">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Unir ficheros mp3 en un único fichero mp3 con CakePHP">
<meta property="og:description" content="Punt de trobada de coneixements">
<meta property="og:url" content="//elboletaire.github.io/racotecnic/2011/01/unir-ficheros-mp3-en-un-unico-fichero-mp3-con-cakephp/">
<meta property="og:site_name" content="Racó Tècnic">





<link rel="canonical" href="//elboletaire.github.io/racotecnic/2011/01/unir-ficheros-mp3-en-un-unico-fichero-mp3-con-cakephp/">
<link href="//elboletaire.github.io/racotecnic/feed.xml" type="application/atom+xml" rel="alternate" title="Racó Tècnic Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="//elboletaire.github.io/racotecnic/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="//elboletaire.github.io/racotecnic/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="//elboletaire.github.io/racotecnic/assets/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="//elboletaire.github.io/racotecnic/assets/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="//elboletaire.github.io/racotecnic/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="//elboletaire.github.io/racotecnic/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="//elboletaire.github.io/racotecnic/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="//elboletaire.github.io/racotecnic/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="//elboletaire.github.io/racotecnic/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="//elboletaire.github.io/racotecnic/images/" alt="Racó Tècnic photo" class="author-photo">
					<h4>Racó Tècnic</h4>
					<p>A subproject from <a href="http://underave.net">underave.net</a> created by <a href="https://github.com/elboletaire">elboletaire</a> and maintained by many collaborators.</p>
				</li>
				<li><a href="//elboletaire.github.io/racotecnic/about/"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:elboletaire@underave.net"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/racotecnic"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				<li>
					<a href="https://facebook.com/racotecnic"><i class="fa fa-fw fa-facebook"></i> Facebook</a>
				</li>
				
				
				<li>
					<a href="https://github.com/elboletaire/racotecnic"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="//elboletaire.github.io/racotecnic/posts/">All Posts</a></li>
				<li><a href="//elboletaire.github.io/racotecnic/tags/">All Tags</a></li>
				<li><a href="//elboletaire.github.io/racotecnic/categories/">All Categories</a></li>
			</ul>
		</li>
		
	    
	    <li><a href="https://github.com/elboletaire/racotecnic" target="_blank">Github</a></li>
	  
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="//elboletaire.github.io/racotecnic/2011/01/unir-ficheros-mp3-en-un-unico-fichero-mp3-con-cakephp/" rel="bookmark" title="Unir ficheros mp3 en un único fichero mp3 con CakePHP">Unir ficheros mp3 en un único fichero mp3 con CakePHP</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2011-01-16T23:16:34+01:00">January 16, 2011</time></span></h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~13 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>Recientemente he creado un podcast para la página de <a href="http://www.musicavermella.com" target="_blank">Música Vermella</a> con el inconveniente añadido de que se suben mp3 independientes para cada publicación.</p>

<p>Para solucionarlo he utilizado la librería getid3 para unir los ficheros mp3 de cada publicación en un único fichero mp3.</p>

<p>Para verlo podéis agregar el <a href="http://musicavermella.com/releases.pod">Podcast de Música Vermella</a> a vuestro cliente de Podcast (iTunes, Rythmbox, Banshee, Miro…).</p>

<p>Quería hacer un tutorial sobre cómo crear un podcast con CakePHP pero lo dejaré para otro tutorial por tal de no complicar este.</p>

<blockquote>
  <p><strong>Puedes ver la segunda parte aquí:</strong> <a href="http://www.racotecnic.com/2011/02/crear-un-podcast-en-cakephp/">Crear un Podcast en CakePHP</a></p>
</blockquote>

<p>Para empezar necesitaréis descargar la librería <a href="http://getid3.org" target="_blank">Getid3</a>. Descargad la versión estable por si acaso ya que la versión beta falla con las etiquetas id3 (que no utilizaremos) así que si queréis utilizarla es bajo vuestra propia responsabilidad.<a id="more"></a><a id="more-1751"></a></p>

<p><a href="http://sourceforge.net/project/showfiles.php?group_id=55859&amp;package_id=50965" target="_blank">Getid3 versión 1.8.2 (estable)</a></p>

<p>Descomprimid el contenido del fichero que descarguéis en Getid3 y ponedlo en la carpeta /app/vendors, de manera que quede así:</p>

<div class="no-line-numbers highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>/app/vendors/getid3/demos/
/app/vendors/getid3/getid3/
/app/vendors/getid3/helperapps/
/app/vendors/getid3/demás ficheros
</pre></td></tr></tbody></table>
</div>
</div>

<p>Ahora necesitaremos el método para unir los mp3. Lo podéis encontrar en la carpeta de demos de getid3. De todos modos os dejo aquí un pequeño componente que tengo yo para utilizar getid3:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167</pre></td><td class="code"><pre><span class="cp">&lt;?php</span>
<span class="c1">// /app/controllers/components/getid3.php
</span><span class="k">class</span> <span class="nc">Getid3Component</span> <span class="k">extends</span> <span class="nx">Object</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="nv">$errors</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

  <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="nb">set_time_limit</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="mi">3600</span><span class="p">);</span>
    <span class="nb">ignore_user_abort</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="nf">error</span><span class="p">(</span><span class="nv">$text</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nb">array_push</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">errors</span><span class="p">,</span> <span class="nv">$text</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="nf">extract</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span>
  <span class="p">{</span>

    <span class="nx">App</span><span class="o">::</span><span class="na">import</span><span class="p">(</span><span class="s1">'vendor'</span><span class="p">,</span><span class="s1">'getid3/getid3'</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="s1">'file'</span><span class="o">=&gt;</span><span class="s1">'getid3.php'</span><span class="p">));</span>
    <span class="c1">// Initialize getID3 engine
</span>    <span class="nv">$getID3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">getID3</span><span class="p">;</span>
    <span class="nv">$getID3</span><span class="o">-&gt;</span><span class="na">setOption</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'encoding'</span> <span class="o">=&gt;</span> <span class="nx">Configure</span><span class="o">::</span><span class="na">read</span><span class="p">(</span><span class="s1">'App.encoding'</span><span class="p">)));</span>

    <span class="c1">// Analyze file and store returned data in $ThisFileInfo
</span>    <span class="nv">$ThisFileInfo</span> <span class="o">=</span> <span class="nv">$getID3</span><span class="o">-&gt;</span><span class="na">analyze</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$ThisFileInfo</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">extract</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span> <span class="p">}</span>

  <span class="k">function</span> <span class="nf">getId3Clean</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$info</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">read</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>

    <span class="nv">$id3</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$info</span><span class="p">[</span><span class="s1">'tags'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$tag</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">foreach</span> <span class="p">(</span><span class="nv">$tag</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$id3</span><span class="p">[</span><span class="nv">$key</span><span class="p">]))</span> <span class="p">{</span>
          <span class="nv">$id3</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$val</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$id3</span><span class="p">[</span><span class="nv">$key</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$id3</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$val</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$id3</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="nf">getCustomTags</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$id3</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getId3Clean</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>
    <span class="nv">$vars</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
      <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'content_group_description'</span><span class="p">,</span>
      <span class="s1">'set'</span>         <span class="o">=&gt;</span> <span class="s1">'part_of_a_set'</span>
    <span class="p">);</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$vars</span> <span class="k">as</span> <span class="nv">$k</span> <span class="o">=&gt;</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$id3</span><span class="p">[</span><span class="nv">$v</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$id3</span><span class="p">[</span><span class="nv">$k</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$id3</span><span class="p">[</span><span class="nv">$v</span><span class="p">];</span>
        <span class="nb">unset</span><span class="p">(</span><span class="nv">$id3</span><span class="p">[</span><span class="nv">$v</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$id3</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="nf">write</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$data</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nx">App</span><span class="o">::</span><span class="na">import</span><span class="p">(</span><span class="s1">'vendor'</span><span class="p">,</span> <span class="s1">'getid3/getid3/getid3'</span><span class="p">);</span>

    <span class="c1">// Initialize getID3 engine
</span>    <span class="nv">$getID3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">getID3</span><span class="p">;</span>
    <span class="nv">$getID3</span><span class="o">-&gt;</span><span class="na">setOption</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'encoding'</span> <span class="o">=&gt;</span> <span class="nx">Configure</span><span class="o">::</span><span class="na">read</span><span class="p">(</span><span class="s1">'App.encoding'</span><span class="p">)));</span>

    <span class="nx">App</span><span class="o">::</span><span class="na">import</span><span class="p">(</span><span class="s1">'vendor'</span><span class="p">,</span><span class="s1">'getid3/getid3'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'file'</span> <span class="o">=&gt;</span> <span class="s1">'write.php'</span><span class="p">));</span>

    <span class="c1">// Initialize getID3 tag-writing module
</span>    <span class="nv">$tagwriter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">getid3_writetags</span><span class="p">;</span>

    <span class="c1">//$tagwriter-&gt;filename       = '/path/to/file.mp3';
</span>    <span class="nv">$tagwriter</span><span class="o">-&gt;</span><span class="na">filename</span>   <span class="o">=</span> <span class="nv">$filename</span><span class="p">;</span>
    <span class="nv">$tagwriter</span><span class="o">-&gt;</span><span class="na">tagformats</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'id3v1'</span><span class="p">,</span> <span class="s1">'id3v2.3'</span><span class="p">);</span>

    <span class="c1">// set various options (optional)
</span>    <span class="nv">$tagwriter</span><span class="o">-&gt;</span><span class="na">overwrite_tags</span>    <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nv">$tagwriter</span><span class="o">-&gt;</span><span class="na">tag_encoding</span>      <span class="o">=</span> <span class="nx">Configure</span><span class="o">::</span><span class="na">read</span><span class="p">(</span><span class="s1">'App.encoding'</span><span class="p">);</span>
    <span class="nv">$tagwriter</span><span class="o">-&gt;</span><span class="na">remove_other_tags</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="c1">// populate data array
</span>    <span class="nv">$TagData</span><span class="p">[</span><span class="s1">'title'</span><span class="p">][]</span>   <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'title'</span><span class="p">])</span><span class="o">?</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span><span class="o">:</span><span class="kc">null</span><span class="p">;</span>
    <span class="nv">$TagData</span><span class="p">[</span><span class="s1">'artist'</span><span class="p">][]</span>  <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'artist'</span><span class="p">])</span><span class="o">?</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'artist'</span><span class="p">]</span><span class="o">:</span><span class="kc">null</span><span class="p">;</span>
    <span class="nv">$TagData</span><span class="p">[</span><span class="s1">'album'</span><span class="p">][]</span>   <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'album'</span><span class="p">])</span><span class="o">?</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'album'</span><span class="p">]</span><span class="o">:</span><span class="kc">null</span><span class="p">;;</span>
    <span class="nv">$TagData</span><span class="p">[</span><span class="s1">'year'</span><span class="p">][]</span>    <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'year'</span><span class="p">])</span><span class="o">?</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'year'</span><span class="p">]</span><span class="o">:</span><span class="kc">null</span><span class="p">;;</span>
    <span class="nv">$TagData</span><span class="p">[</span><span class="s1">'genre'</span><span class="p">][]</span>   <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'genre'</span><span class="p">])</span><span class="o">?</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'genre'</span><span class="p">]</span><span class="o">:</span><span class="kc">null</span><span class="p">;;</span>
    <span class="nv">$TagData</span><span class="p">[</span><span class="s1">'comment'</span><span class="p">][]</span> <span class="o">=</span> <span class="s1">'from www.underave.net'</span><span class="p">;</span>
    <span class="nv">$TagData</span><span class="p">[</span><span class="s1">'track'</span><span class="p">][]</span>   <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'track'</span><span class="p">])</span><span class="o">?</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'track'</span><span class="p">]</span><span class="o">:</span><span class="kc">null</span><span class="p">;;</span>

    <span class="nv">$tagwriter</span><span class="o">-&gt;</span><span class="na">tag_data</span> <span class="o">=</span> <span class="nv">$TagData</span><span class="p">;</span>

    <span class="c1">// write tags
</span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$tagwriter</span><span class="o">-&gt;</span><span class="na">WriteTags</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$tagwriter</span><span class="o">-&gt;</span><span class="na">warnings</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$tagwriter</span><span class="o">-&gt;</span><span class="na">warnings</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nv">$tagwriter</span><span class="o">-&gt;</span><span class="na">errors</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="nf">joinMp3</span><span class="p">(</span><span class="nv">$file_out</span><span class="p">,</span> <span class="nv">$files_in</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$files_in</span> <span class="k">as</span> <span class="nv">$nextinputfilename</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_readable</span><span class="p">(</span><span class="nv">$nextinputfilename</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s1">'Cannot read "'</span> <span class="o">.</span> <span class="nv">$nextinputfilename</span> <span class="o">.</span> <span class="s1">'"'</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">errors</span><span class="p">))</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_writeable</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="nv">$file_out</span><span class="p">)))</span> <span class="p">{</span>
      <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s1">'Cannot write "'</span> <span class="o">.</span> <span class="nv">$file_out</span> <span class="o">.</span> <span class="s1">'"'</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">App</span><span class="o">::</span><span class="na">import</span><span class="p">(</span><span class="s1">'vendor'</span><span class="p">,</span> <span class="s1">'getid3/getid3'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'file'</span> <span class="o">=&gt;</span> <span class="s1">'getid3.php'</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$fp_output</span> <span class="o">=</span> <span class="o">@</span><span class="nb">fopen</span><span class="p">(</span><span class="nv">$file_out</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// Initialize getID3 engine
</span>      <span class="nv">$getID3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">getID3</span><span class="p">;</span>
      <span class="k">foreach</span> <span class="p">(</span><span class="nv">$files_in</span> <span class="k">as</span> <span class="nv">$nextinputfilename</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$current_file_info</span> <span class="o">=</span> <span class="nv">$getID3</span><span class="o">-&gt;</span><span class="na">analyze</span><span class="p">(</span><span class="nv">$nextinputfilename</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$current_file_info</span><span class="p">[</span><span class="s1">'fileformat'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'mp3'</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nv">$fp_source</span> <span class="o">=</span> <span class="o">@</span><span class="nb">fopen</span><span class="p">(</span><span class="nv">$nextinputfilename</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$current_output_position</span> <span class="o">=</span> <span class="nb">ftell</span><span class="p">(</span><span class="nv">$fp_output</span><span class="p">);</span>

            <span class="c1">// copy audio data from first file
</span>            <span class="nb">fseek</span><span class="p">(</span><span class="nv">$fp_source</span><span class="p">,</span> <span class="nv">$current_file_info</span><span class="p">[</span><span class="s1">'avdataoffset'</span><span class="p">],</span> <span class="nx">SEEK_SET</span><span class="p">);</span>
            <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$fp_source</span><span class="p">)</span> <span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span> <span class="p">(</span><span class="nb">ftell</span><span class="p">(</span><span class="nv">$fp_source</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nv">$current_file_info</span><span class="p">[</span><span class="s1">'avdataend'</span><span class="p">]))</span> <span class="p">{</span>
              <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$fp_output</span><span class="p">,</span> <span class="nb">fread</span><span class="p">(</span><span class="nv">$fp_source</span><span class="p">,</span> <span class="mi">32768</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fp_source</span><span class="p">);</span>
            <span class="c1">// trim post-audio data (if any) copied from first file that we don't need or want
</span>            <span class="nv">$end_offset</span> <span class="o">=</span> <span class="nv">$current_output_position</span> <span class="o">+</span> <span class="p">(</span><span class="nv">$current_file_info</span><span class="p">[</span><span class="s1">'avdataend'</span><span class="p">]</span> <span class="o">-</span> <span class="nv">$current_file_info</span><span class="p">[</span><span class="s1">'avdataoffset'</span><span class="p">]);</span>
            <span class="nb">fseek</span><span class="p">(</span><span class="nv">$fp_output</span><span class="p">,</span> <span class="nv">$end_offset</span><span class="p">,</span> <span class="nx">SEEK_SET</span><span class="p">);</span>
            <span class="nb">ftruncate</span><span class="p">(</span><span class="nv">$fp_output</span><span class="p">,</span> <span class="nv">$end_offset</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s1">'failed to open ''.$nextinputfilename.'' for reading'</span><span class="p">);</span>
            <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fp_output</span><span class="p">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s1">'''.$nextinputfilename.'' is not MP3 format'</span><span class="p">);</span>
          <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fp_output</span><span class="p">);</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s1">'failed to open ''.$file_out.'' for writing'</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fp_output</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>Con este componente podéis tanto unir mp3 como leer y escribir etiquetas id3.</p>

<p>Evidentemente, antes de poder utilizar el componente debéis declararlo en el array de componentes de vuestro controlador:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">FooController</span> <span class="k">extends</span> <span class="nx">AppController</span> <span class="p">{</span>
  <span class="nv">$components</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'Getid3'</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>Para unir mp3 en un solo fichero no tenéis más que pasarle como primer parámetro la ruta del fichero de salida y como segundo parámetro pasarle un array con las ubicaciones de los ficheros mp3:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre><span class="nv">$destino</span> <span class="o">=</span> <span class="nx">WWW_ROOT</span> <span class="o">.</span> <span class="s1">'files'</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">'podcasts'</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">'fichero_destino.mp3'</span><span class="p">;</span>
<span class="nv">$mp3</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
  <span class="nx">WWW_ROOT</span> <span class="o">.</span> <span class="s1">'files'</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">'mp3'</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">'fichero1.mp3'</span><span class="p">,</span>
  <span class="nx">WWW_ROOT</span> <span class="o">.</span> <span class="s1">'files'</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">'mp3'</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">'fichero2.mp3'</span><span class="p">,</span>
  <span class="nx">WWW_ROOT</span> <span class="o">.</span> <span class="s1">'files'</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">'mp3'</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">'fichero3.mp3'</span><span class="p">,</span>
  <span class="nx">WWW_ROOT</span> <span class="o">.</span> <span class="s1">'files'</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">'mp3'</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">'fichero4.mp3'</span><span class="p">,</span>
  <span class="nx">WWW_ROOT</span> <span class="o">.</span> <span class="s1">'files'</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">'mp3'</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">'fichero5.mp3'</span>
<span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Getid3</span><span class="o">-&gt;</span><span class="na">joinMp3</span><span class="p">(</span><span class="nv">$destino</span><span class="p">,</span> <span class="nv">$mp3</span><span class="p">))</span> <span class="p">{</span>
  <span class="c1">// fichero creado correctamente
</span><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">pr</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Getid3</span><span class="o">-&gt;</span><span class="na">errors</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>Y con esto termina este sencillo tutorial sobre <strong>cómo crear un podcast a partir de varios mp3</strong>.</p>

<p>Como he dicho al inicio, pronto explicaré <a href="http://www.racotecnic.com/2011/02/crear-un-podcast-en-cakephp/">cómo crear el XML de dicho Podcast</a> para que podáis agregarlo a iTunes o cualquier otro <em>podcatcher</em>.</p>

      <footer class="entry-meta">
        <span class="entry-tags">
            
            <a href="//elboletaire.github.io/racotecnic/etiqueta/CakePHP" title="Pages tagged CakePHP" class="tag">
                <span class="term">CakePHP</span>
            </a>
            
            
            <a href="//elboletaire.github.io/racotecnic/etiqueta/ID3" title="Pages tagged ID3" class="tag">
                <span class="term">ID3</span>
            </a>
            
            
            <a href="//elboletaire.github.io/racotecnic/etiqueta/getID3" title="Pages tagged getID3" class="tag">
                <span class="term">getID3</span>
            </a>
            
            
            <a href="//elboletaire.github.io/racotecnic/etiqueta/mp3" title="Pages tagged mp3" class="tag">
                <span class="term">mp3</span>
            </a>
            
            
            <a href="//elboletaire.github.io/racotecnic/etiqueta/CakePHP 1.1" title="Pages tagged CakePHP 1.1" class="tag">
                <span class="term">CakePHP 1.1</span>
            </a>
            
            
            <a href="//elboletaire.github.io/racotecnic/etiqueta/CakePHP 1.3" title="Pages tagged CakePHP 1.3" class="tag">
                <span class="term">CakePHP 1.3</span>
            </a>
            
            
            <a href="//elboletaire.github.io/racotecnic/etiqueta/CakePHP 1.2" title="Pages tagged CakePHP 1.2" class="tag">
                <span class="term">CakePHP 1.2</span>
            </a>
            
            
        </span>
        
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=//elboletaire.github.io/racotecnic/2011/01/unir-ficheros-mp3-en-un-unico-fichero-mp3-con-cakephp/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=//elboletaire.github.io/racotecnic/2011/01/unir-ficheros-mp3-en-un-unico-fichero-mp3-con-cakephp/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=//elboletaire.github.io/racotecnic/2011/01/unir-ficheros-mp3-en-un-unico-fichero-mp3-con-cakephp/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="//elboletaire.github.io/racotecnic/2011/01/escuchando-conversaciones-de-facebook/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="//elboletaire.github.io/racotecnic/2016/05/guarda-gratis-en-la-nube-tus-partidas-guardadas-o-como-hacer-copias-de-seguridad-en-la-nube-gratis/" title="Guarda GRATIS en la nube tus partidas guardadas o cómo hacer copias de seguridad en la nube gratis">Guarda GRATIS en la nube tus partidas guardadas o cómo hacer copias de seguridad en la nube gratis</a></h3>
      <p>Ya hace unos años que hago esto y la verdad es que es muy práctico. Consistebásicamente en subir automáticamente las partidas guardadas a...&hellip; <a href="//elboletaire.github.io/racotecnic/2016/05/guarda-gratis-en-la-nube-tus-partidas-guardadas-o-como-hacer-copias-de-seguridad-en-la-nube-gratis/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="//elboletaire.github.io/racotecnic/2015/03/instalacion-wamp-a-pelo-con-multiples-versiones-de-php/" title="Instalación WAMP a pelo con múltiples versiones de PHP o cómo configurar Apache para correr varias versiones de PHP en distintos servidores virtuales">Instalación WAMP a pelo con múltiples versiones de PHP o cómo configurar Apache para correr varias versiones de PHP en distintos servidores virtuales</a></h4>
        <span>Published on March 16, 2015</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="//elboletaire.github.io/racotecnic/2014/01/ordenar-por-columnas-en-laravel-4-o-como-extender-laravel-4-a-nuestro-gusto/" title="Ordenar por columnas en Laravel 4 o cómo extender Laravel 4 a tu gusto">Ordenar por columnas en Laravel 4 o cómo extender Laravel 4 a tu gusto</a></h4>
        <span>Published on January 18, 2014</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2017 Racó Tècnic. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="//elboletaire.github.io/racotecnic/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="//elboletaire.github.io/racotecnic/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-106861877-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>



    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'racotecnic'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</body>
</html>
