<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Ordenar por columnas en Laravel 4 o cómo extender Laravel 4 a tu gusto &#8211; Racó Tècnic</title>
<meta name="description" content="Punt de trobada de coneixements">
<meta name="keywords" content="Paginació, Laravel, Laravel 4, Eloquent, Blade">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="//elboletaire.github.io/racotecnic/images/">
<meta name="twitter:title" content="Ordenar por columnas en Laravel 4 o cómo extender Laravel 4 a tu gusto">
<meta name="twitter:description" content="Punt de trobada de coneixements">
<meta name="twitter:creator" content="@racotecnic">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Ordenar por columnas en Laravel 4 o cómo extender Laravel 4 a tu gusto">
<meta property="og:description" content="Punt de trobada de coneixements">
<meta property="og:url" content="//elboletaire.github.io/racotecnic/2014/01/ordenar-por-columnas-en-laravel-4-o-como-extender-laravel-4-a-nuestro-gusto/">
<meta property="og:site_name" content="Racó Tècnic">





<link rel="canonical" href="//elboletaire.github.io/racotecnic/2014/01/ordenar-por-columnas-en-laravel-4-o-como-extender-laravel-4-a-nuestro-gusto/">
<link href="//elboletaire.github.io/racotecnic/feed.xml" type="application/atom+xml" rel="alternate" title="Racó Tècnic Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="//elboletaire.github.io/racotecnic/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="//elboletaire.github.io/racotecnic/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="//elboletaire.github.io/racotecnic/assets/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="//elboletaire.github.io/racotecnic/assets/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="//elboletaire.github.io/racotecnic/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="//elboletaire.github.io/racotecnic/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="//elboletaire.github.io/racotecnic/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="//elboletaire.github.io/racotecnic/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="//elboletaire.github.io/racotecnic/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="//elboletaire.github.io/racotecnic/images/" alt="Racó Tècnic photo" class="author-photo">
					<h4>Racó Tècnic</h4>
					<p>A subproject from <a href="http://underave.net">underave.net</a> created by <a href="https://github.com/elboletaire">elboletaire</a> and maintained by many collaborators.</p>
				</li>
				<li><a href="//elboletaire.github.io/racotecnic/about/"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:elboletaire@underave.net"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/racotecnic"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				<li>
					<a href="https://facebook.com/racotecnic"><i class="fa fa-fw fa-facebook"></i> Facebook</a>
				</li>
				
				
				<li>
					<a href="https://github.com/elboletaire/racotecnic"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="//elboletaire.github.io/racotecnic/posts/">All Posts</a></li>
				<li><a href="//elboletaire.github.io/racotecnic/tags/">All Tags</a></li>
				<li><a href="//elboletaire.github.io/racotecnic/categories/">All Categories</a></li>
			</ul>
		</li>
		
	    
	    <li><a href="https://github.com/elboletaire/racotecnic" target="_blank">Github</a></li>
	  
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="//elboletaire.github.io/racotecnic/2014/01/ordenar-por-columnas-en-laravel-4-o-como-extender-laravel-4-a-nuestro-gusto/" rel="bookmark" title="Ordenar por columnas en Laravel 4 o cómo extender Laravel 4 a tu gusto">Ordenar por columnas en Laravel 4 o cómo extender Laravel 4 a tu gusto</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2014-01-18T18:30:38+01:00">January 18, 2014</time></span></h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~16 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>Si has trasteado o estás trasteando con <a href="http://laravel.com/" title="Web oficial de Laravel" rel="nofollow external">Laravel 4</a> habrás notado que está algo verde. Entre varias cosas se echa en falta que no tenga una manera sencilla para poder ordenar los resultados por columnas.</p>

<p>Dado que yo vengo de CakePHP, me he inspirado en él para crear el sistema de ordenación por columnas, así que si en Cake podemos crear un enlace para ordenar así:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="nt">&lt;tr&gt;</span>
  <span class="nt">&lt;th&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Paginator</span><span class="o">-&gt;</span><span class="na">sort</span><span class="p">(</span><span class="s1">'id'</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="nt">&lt;/th&gt;</span>
  <span class="nt">&lt;th&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Paginator</span><span class="o">-&gt;</span><span class="na">sort</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'Nom'</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="nt">&lt;/th&gt;</span>
  <span class="nt">&lt;th&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Paginator</span><span class="o">-&gt;</span><span class="na">sort</span><span class="p">(</span><span class="s1">'address'</span><span class="p">,</span> <span class="s1">'Adreça'</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>En este tutorial verás cómo hacer para poder ordenar así, utilizando blade (el sistema de plantillas por defecto de Laravel 4):</p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;th&gt;</span>{{ $posts-&gt;sort('id') }}<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>{{ $posts-&gt;sort('name', 'Nom') }}<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>{{ $posts-&gt;sort('address', 'Adreça') }}<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><a href="//elboletaire.github.io/racotecnic/uploads/2014/01/laravel_paginate.png" style="display:block; text-align:center">
  <img src="//elboletaire.github.io/racotecnic/uploads/2014/01/laravel_paginate.png" alt="laravel_paginate" />
</a></p>

<p>Para poder hacer esto tendrás que extender el paginador de Laravel para añadirle las funciones que necesites (como <code class="highlighter-rouge">sort</code>).</p>

<p>Dado que lo que es ordenar en sí no tiene ninguna complicación y lo puedes encontrar documentado, en este tutorial me centraré más en <strong>cómo extender classes de Laravel 4 para adaptarlo a tus necesidades</strong> y de paso verás cómo tener la ordenación por columnas bien organizada (a nivel código) para mejor reutilización en futuros proyectos.</p>

<blockquote>
  <p><strong>Nota:</strong> Debido al continuo desarrollo de Laravel este tutorial ha quedado rápidamente desfasado. He actualizado todos los enlaces para que funcionen correctamente pero ten en cuenta que algunos de estos ficheros han cambiado mucho o directamente ya no existen.</p>
</blockquote>

<p><a id="more"></a><a id="more-2277"></a></p>

<p>Antes de empezar me gustaría aclarar que no soy experto en Laravel ni mucho menos, simplemente me puse a trastear con él, vi que no tenía esta funcionalidad y exploré hasta encontrar la manera de integrarlo mejor en mi aplicación. Gracias a ello aprendí mucho mejor cómo funciona Laravel (internamente) y es en parte esto lo que quiero compartir contigo.</p>

<p>Por otro lado, a pesar de que el siguiente post rebosa de referencias externas a documentación, código incrustado y código en github, no estaría de más que hubieras leído la documentación de Laravel 4 antes de empezar.</p>

<h2 id="entendiendo-el-paginador">Entendiendo el paginador</h2>

<h3 id="la-facade-paginator">La <em>Facade</em> Paginator</h3>

<blockquote>
  <p><b>Nota:</b> Si no sabes qué es una <i>Facade</i>, <a href="http://laravel.com/docs/facades" rel="nofollow external" title="Abrir documentación sobre Facades">repásate la documentación</a>.</p>
</blockquote>

<p>Para hacer todo esto lo primero que hay que hacer es entender cómo funciona el paginador actual de Laravel 4. Vayamos al grano.</p>

<p>Si accedes al directorio <a href="https://github.com/laravel/framework/tree/a54dda66de814f8c2085e71c69e44e91f1b46a9c/src/Illuminate/Pagination" rel="nofollow external">vendor/laravel/framework/src/Illuminate/Pagination</a> verás que hay un directorio llamado <a href="https://github.com/laravel/framework/tree/a54dda66de814f8c2085e71c69e44e91f1b46a9c/src/Illuminate/Pagination/views" title="Ver en github" rel="nofollow external">views</a>, un fichero <code class="highlighter-rouge">composer.json</code> y cuatro ficheros php.</p>

<p>En la carpeta <code class="highlighter-rouge">views</code> hay tres plantillas para mostrar los <a href="http://laravel.com/docs/pagination" rel="nofollow external">botones de la paginación</a>. Si no leíste la documentación de Laravel sobre la paginación, gracias a este directorio acabas de averiguar que los botones de paginación tienen plantillas y que hay tres definidas por defecto.</p>

<p>El fichero <code class="highlighter-rouge">composer.json</code> ignóralo y de los ficheros PHP, fíjate en los tres siguientes:</p>

<ul>
  <li><a href="https://github.com/laravel/framework/tree/a54dda66de814f8c2085e71c69e44e91f1b46a9c/src/Illuminate/Pagination/Paginator.php">Paginator.php</a></li>
  <li><a href="https://github.com/laravel/framework/tree/a54dda66de814f8c2085e71c69e44e91f1b46a9c/src/Illuminate/Pagination/PaginationServiceProvider.php">PaginationServiceProvider.php</a></li>
  <li><a href="https://github.com/laravel/framework/tree/a54dda66de814f8c2085e71c69e44e91f1b46a9c/src/Illuminate/Pagination/Environment.php">Environment.php</a></li>
</ul>

<p>El fichero <code class="highlighter-rouge">Paginator.php</code> es el que realmente te interesa ya que aquí es donde residen métodos como <a href="https://github.com/laravel/framework/tree/a54dda66de814f8c2085e71c69e44e91f1b46a9c/src/Illuminate/Pagination/Paginator.php#L176" rel="nofollow external" title="Ver en github"><code class="highlighter-rouge">links()</code></a> y por tanto es donde te interesa añadir el método <code class="highlighter-rouge">sort()</code>.</p>

<p>No obstante, para poder hacer todo esto posible necesitarás hacer tu propio <code class="highlighter-rouge">PaginationServiceProvider.php</code> y tu propio <code class="highlighter-rouge">Environment.php</code>, ya que es en esos dos ficheros donde se inicializa el paginador.</p>

<p>Para entender esto mejor, abre tu fichero <code class="highlighter-rouge">app.php</code> y en el array de providers fíjate que, entre varios providers, <a href="https://github.com/laravel/laravel/tree/3ad58caba6c79c487deecb2fd7b0ea94e45b4f38/app/config/app.php#L98" title="Ver en github" rel="nofollow external">hay el siguiente</a>:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="k">return</span> <span class="k">array</span><span class="p">(</span>
  <span class="c1">// ... otros parámetros de configuración ...
</span>
  <span class="s1">'providers'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="c1">// ... otros providers ...
</span>    <span class="s1">'Illuminate\Pagination\PaginationServiceProvider'</span><span class="p">,</span>
    <span class="c1">// ... más providers ...
</span>  <span class="p">)</span>

  <span class="c1">// ... más parámetros de configuración ...
</span><span class="p">);</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>Así pues, para cargar el paginador lo primero que hace Laravel es cargar la clase <code class="highlighter-rouge">PaginationServiceProvider</code>.</p>

<p>Si abres este fichero podrás observar cómo en el método <a href="https://github.com/laravel/framework/tree/a54dda66de814f8c2085e71c69e44e91f1b46a9c/src/Illuminate/Pagination/PaginationServiceProvider.php#L23" title="Ver en github" rel="nofollow external"><code class="highlighter-rouge">register</code></a> se inicializa la clase <code class="highlighter-rouge">Environment</code>.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre><span class="sd">/**
 * Register the service provider.
 *
 * @return void
 */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
<span class="p">{</span>
  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="p">[</span><span class="s1">'paginator'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">share</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$paginator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Environment</span><span class="p">(</span><span class="nv">$app</span><span class="p">[</span><span class="s1">'request'</span><span class="p">],</span> <span class="nv">$app</span><span class="p">[</span><span class="s1">'view'</span><span class="p">],</span> <span class="nv">$app</span><span class="p">[</span><span class="s1">'translator'</span><span class="p">]);</span>

    <span class="nv">$paginator</span><span class="o">-&gt;</span><span class="na">setViewName</span><span class="p">(</span><span class="nv">$app</span><span class="p">[</span><span class="s1">'config'</span><span class="p">][</span><span class="s1">'view.pagination'</span><span class="p">]);</span>

    <span class="k">return</span> <span class="nv">$paginator</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>Y en la clase <code class="highlighter-rouge">Enviornment</code>, finalmente, en el método <a href="https://github.com/laravel/framework/tree/a54dda66de814f8c2085e71c69e44e91f1b46a9c/src/Illuminate/Pagination/Environment.php#L103" title="Ver en github" rel="nofollow external"><code class="highlighter-rouge">make()</code></a> se innicializa la clase <code class="highlighter-rouge">Paginator</code>.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="sd">/**
 * Get a new paginator instance.
 *
 * @param  array  $items
 * @param  int    $total
 * @param  int    $perPage
 * @return \Illuminate\Pagination\Paginator
 */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">make</span><span class="p">(</span><span class="k">array</span> <span class="nv">$items</span><span class="p">,</span> <span class="nv">$total</span><span class="p">,</span> <span class="nv">$perPage</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$paginator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Paginator</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="nv">$items</span><span class="p">,</span> <span class="nv">$total</span><span class="p">,</span> <span class="nv">$perPage</span><span class="p">);</span>

  <span class="k">return</span> <span class="nv">$paginator</span><span class="o">-&gt;</span><span class="na">setupPaginationContext</span><span class="p">();</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><b>Resumiendo:</b> En <code class="highlighter-rouge">app.php</code> se carga el <code class="highlighter-rouge">PaginationServiceProvider</code> que carga <code class="highlighter-rouge">Environment</code> que a su vez carga <code class="highlighter-rouge">Paginator</code>; así que habrá que crear tres clases para poder crear el método <code class="highlighter-rouge">sort()</code>.</p>

<h3 id="el-método-paginate-de-eloquent">El método paginate de Eloquent</h3>

<p>Esto que has visto únicamente es para añadir el método <code class="highlighter-rouge">sort()</code>, que básicamente pintará enlaces en las vistas, pero todavía tienes que hacer que la paginación te haga caso y ordene según los parámetros establecidos.</p>

<p>Si recuerdas <a href="http://laravel.com/docs/pagination" rel="nofollow external" title="Abrir documentación sobre la paginación">la documentación de Laravel</a>, para hacer la paginación de elementos debes hacer algo así (los ejemplos a continuación son de un controlador):</p>

<div class="language-php highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
<span class="p">{</span>
  <span class="nv">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="na">paginate</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="s1">'posts.admin.index'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">'posts'</span><span class="p">,</span> <span class="nv">$posts</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>Éste método <a href="https://github.com/laravel/framework/tree/a54dda66de814f8c2085e71c69e44e91f1b46a9c/src/Illuminate/Database/Eloquent/Builder.php" rel="nofollow external" title="Ver en github"><code class="highlighter-rouge">paginate()</code></a> forma parte del <code class="highlighter-rouge">Builder</code> de Eloquent, así que también habrá que extenderlo si quieres que la paginación tome parámetros adicionales de la URL para ordenar los resultados.</p>

<p>Si en lugar de paginar como en el ejemplo anterior lo hubiera hecho así:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
<span class="p">{</span>
  <span class="nv">$posts</span> <span class="o">=</span> <span class="nx">Db</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">'posts'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">(</span><span class="s1">'15'</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="s1">'posts.admin.index'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">'posts'</span><span class="p">,</span> <span class="nv">$posts</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>En vez de modificar el Builder de Eloquent tendrías que modificar el <a href="https://github.com/laravel/framework/tree/a54dda66de814f8c2085e71c69e44e91f1b46a9c/src/Illuminate/Database/Query/Builder.php#L1394" rel="nofollow external" title="Ver en github">Builder de queries</a>. Aun así, en este tutorial me centraré en el método <code class="highlighter-rouge">paginate()</code> del Builder de Eloquent (primer ejemplo).</p>

<p>No obstante, el Builder de Eloquent no se carga igual que el paginador. Éste está inyectado en los modelos, por lo que podrías modificar el método <code class="highlighter-rouge">paginate</code> directamente redefiniéndolo en el modelo deseado, ya que éste extiende de Eloquent:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="c1">// app/models/Post.php
</span><span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">Eloquent</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">function</span> <span class="nf">paginate</span><span class="p">(</span><span class="nv">$perPage</span><span class="p">,</span> <span class="nv">$columns</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'*'</span><span class="p">),</span> <span class="nv">$orderBy</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span>
  <span class="p">{</span>
    <span class="c1">// nuestros cambios para ordenar por columna
</span>  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>Fácilmente puedes añadirlo en un nuevo modelo padre del cual extender, por ejemplo <code class="highlighter-rouge">AppModel</code> (ya que digo que vengo de CakePHP, voy a demostrarlo):</p>

<div class="language-php highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="c1">// app/models/AppModel.php
</span><span class="k">class</span> <span class="nc">AppModel</span> <span class="k">extends</span> <span class="nx">Eloquent</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">function</span> <span class="nf">paginate</span><span class="p">(</span><span class="nv">$perPage</span><span class="p">,</span> <span class="nv">$columns</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'*'</span><span class="p">),</span> <span class="nv">$orderBy</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span>
  <span class="p">{</span>
    <span class="c1">// nuestros cambios para ordenar por columna
</span>  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// app/models/Post.php
</span><span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">AppModel</span>
<span class="p">{</span>

<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>Pero esto en realidad no sería muy reusable, así que en su lugar, y ya que Laravel está pensado para ser utilizado con PHP &gt;= 5.4, lo que harás será crear un <a href="http://www.php.net/manual/es/language.oop5.traits.php" rel="nofollow external" title="Ver en php.net">trait</a>.</p>

<p>Habiendo creado el trait simplemente habrá que indicarlo en aquellos modelos donde quieras utilizarlo:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">Eloquent</span>
<span class="p">{</span>
  <span class="k">use</span> <span class="nx">OrderBy</span><span class="p">;</span> <span class="c1">// donde OrderBy es el nombre que has puesto al trait
</span><span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="los-cambios">Los cambios</h2>

<p>Confiando en que has entendido algo de lo que he explicado hasta ahora, resumiré los cambios a hacer y enlazaré hacia los ficheros que <a href="https://github.com/elboletaire/laravel-utils-and-extensions" rel="external" title="Ver proyecto en github">he publicado en github</a>.</p>

<p>Yo tengo todas mis extensiones dentro del directorio <code class="highlighter-rouge">app/library/Minombre/Extensions</code>, pero tienes que poder ponerlas en cualquier directorio que cargue clases Laravel siempre y cuando respetes los <i>namespaces</i>.</p>

<h3 id="yendo-al-grano">Yendo al grano</h3>

<p>Si quieres ahorrarte el proceso que viene a continuación <a href="https://github.com/elboletaire/laravel-utils-and-extensions" rel="external" title="Ver proyecto en github">puedes añadir mi proyecto</a> como un submódulo de tu proyecto fácilmente:</p>

<div class="language-bash no-line-numbers highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>git submodule add https://github.com/elboletaire/laravel-utils-and-extensions.git app/library/Elboletaire
</pre></td></tr></tbody></table>
</div>
</div>

<p>Si no utilizas git <a href="https://github.com/elboletaire/laravel-utils-and-extensions/archive/master.zip" rel="nofollow">descarga directamente el zip de github</a> y descomprime los contenidos del fichero en un nuevo directorio <code class="highlighter-rouge">app/library/Elboletaire</code>.</p>

<h3 id="el-método-sort">El método <code class="highlighter-rouge">sort</code></h3>

<p>Volviendo al resumen, tienes que crear tu propio <a href="https://github.com/elboletaire/laravel-utils-and-extensions/blob/master/Extensions/Pagination/PaginationServiceProvider.php" rel="nofollow external" title="Ver en github"><code class="highlighter-rouge">PaginationServiceProvider</code></a> para en él cargar un nuevo <a href="https://github.com/elboletaire/laravel-utils-and-extensions/blob/master/Extensions/Pagination/Environment.php" rel="nofollow external" title="Ver en github"><code class="highlighter-rouge">Environment</code></a> que finalmente será quien cargue el <a href="https://github.com/elboletaire/laravel-utils-and-extensions/blob/master/Extensions/Pagination/Paginator.php" rel="nofollow external" title="Ver en github"><code class="highlighter-rouge">Paginator</code></a>.</p>

<p>Es en ésta última clase <code class="highlighter-rouge">Paginator</code> donde deberás definir el método sort y otros métodos necesarios para que éste funcione correctamente. Como digo muy a menudo, el código habla por sí solo, así que no me centraré en explicarlo.</p>

<p>Una vez has creado tus ficheros (con su contenido, evidentemente) tienes que modificar el array de <code class="highlighter-rouge">providers</code> para que cargue tu <code class="highlighter-rouge">PaginationServiceProvider</code> en lugar de el de Laravel:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="k">return</span> <span class="k">array</span><span class="p">(</span>
  <span class="c1">// [...]
</span>
  <span class="s1">'providers'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="c1">// reemplazas el original
</span>    <span class="c1">// 'Illuminate\Pagination\PaginationServiceProvider',
</span>    <span class="c1">// por el tuyo
</span>    <span class="s1">'Elboletaire\Extensions\Pagination\PaginationServiceProvider'</span>
  <span class="p">)</span>

  <span class="c1">// [...]
</span><span class="p">);</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="el-método-paginate">El método <code class="highlighter-rouge">paginate</code></h3>

<p>Crea un trait en el mismo directorio donde has creado los ficheros anteriores; éste será el encaragdo de modificar la consulta hacia la base de datos a partir de los datos recibidos vía <code class="highlighter-rouge">GET</code>.</p>

<p>Puedes ponerle el nombre que quieras, al mío lo he llamado <a href="https://github.com/elboletaire/laravel-utils-and-extensions/blob/master/Extensions/Pagination/PaginatorSort.php" rel="nofollow external" title="Ver en github"><code class="highlighter-rouge">PaginatorSort</code></a>, pero como digo es cuestión de gustos.</p>

<p>Una vez creado y hecha la lógica sólo hay que llamarlo desde el modelo que quieras que tenga ordenación por columnas:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">Eloquent</span>
<span class="p">{</span>
  <span class="k">use</span> <span class="nx">Elboletaire\Extensions\Pagination\PaginatorSort</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="añadiendo-paginación">Añadiendo paginación</h3>

<p>Hechos estos dos sencillos pasos, ya puedes añadir a tus vistas los enlaces para poder ordenar por columna:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;th&gt;</span>{{ $posts-&gt;sort('id') }}<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>{{ $posts-&gt;sort('name', 'Nombre') }}<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>Y mientras tu controlador (o ruta) cargue los datos de la paginación <strong>mediante el modelo</strong> (al que previamente has cargado el trait creado):</p>

<div class="language-php highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
<span class="p">{</span>
  <span class="nv">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="na">paginate</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="s1">'posts.admin.index'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">'posts'</span><span class="p">,</span> <span class="nv">$posts</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>…la paginación estaría funcionando. <i>Congrats my friend</i> :D</p>

<p>Si quieres puedes especificar el orden por defecto pasándolo como tercer parámetro:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
<span class="p">{</span>
  <span class="nv">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="na">paginate</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">'name asc'</span><span class="p">);</span>
  <span class="c1">// o bien pasado como array:
</span>  <span class="nv">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="na">paginate</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'direction'</span> <span class="o">=&gt;</span> <span class="s1">'asc'</span><span class="p">,</span>
    <span class="s1">'sort'</span>      <span class="o">=&gt;</span> <span class="s1">'name'</span>
  <span class="p">));</span>

  <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="s1">'posts.admin.index'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">'posts'</span><span class="p">,</span> <span class="nv">$posts</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="fin-referencias-y-esas-cosas">Fin [referencias y esas cosas]</h2>

<p>Si eres lector asiduo (aunque aquí no nos vaya mucho esto de la asiduidad..) sabrás que estoy abierto a que me preguntéis lo que sea —otra cosa es si sabré contestar…</p>

<p>El repositorio está colgado en github, entre otras cosas, para que la gente colabore; así que si te animas ya sabes.</p>

<blockquote>
  <p><strong>Más información y fuentes:</strong></p>

  <ul>
    <li><a rel="nofollow external" href="http://laravel.com/docs">Documentación de Laravel</a></li>
    <li><a rel="nofollow external" href="http://www.php.net/manual/en/language.oop5.traits.php">Documentación acerca de los traits</a></li>
    <li><a rel="nofollow external" href="http://forums.laravel.io/viewtopic.php?pid=39576#p39576">How to extend Illuminate\Database\Eloquent\Builder class?</a></li>
  </ul>
</blockquote>

      <footer class="entry-meta">
        <span class="entry-tags">
            
            <a href="//elboletaire.github.io/racotecnic/etiqueta/Paginació" title="Pages tagged Paginació" class="tag">
                <span class="term">Paginació</span>
            </a>
            
            
            <a href="//elboletaire.github.io/racotecnic/etiqueta/Laravel" title="Pages tagged Laravel" class="tag">
                <span class="term">Laravel</span>
            </a>
            
            
            <a href="//elboletaire.github.io/racotecnic/etiqueta/Laravel 4" title="Pages tagged Laravel 4" class="tag">
                <span class="term">Laravel 4</span>
            </a>
            
            
            <a href="//elboletaire.github.io/racotecnic/etiqueta/Eloquent" title="Pages tagged Eloquent" class="tag">
                <span class="term">Eloquent</span>
            </a>
            
            
            <a href="//elboletaire.github.io/racotecnic/etiqueta/Blade" title="Pages tagged Blade" class="tag">
                <span class="term">Blade</span>
            </a>
            
            
        </span>
        
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=//elboletaire.github.io/racotecnic/2014/01/ordenar-por-columnas-en-laravel-4-o-como-extender-laravel-4-a-nuestro-gusto/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=//elboletaire.github.io/racotecnic/2014/01/ordenar-por-columnas-en-laravel-4-o-como-extender-laravel-4-a-nuestro-gusto/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=//elboletaire.github.io/racotecnic/2014/01/ordenar-por-columnas-en-laravel-4-o-como-extender-laravel-4-a-nuestro-gusto/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="//elboletaire.github.io/racotecnic/2013/12/tema-de-oh-my-zsh-inspirado-en-af-magic-y-posh-git/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="//elboletaire.github.io/racotecnic/2016/05/guarda-gratis-en-la-nube-tus-partidas-guardadas-o-como-hacer-copias-de-seguridad-en-la-nube-gratis/" title="Guarda GRATIS en la nube tus partidas guardadas o cómo hacer copias de seguridad en la nube gratis">Guarda GRATIS en la nube tus partidas guardadas o cómo hacer copias de seguridad en la nube gratis</a></h3>
      <p>Ya hace unos años que hago esto y la verdad es que es muy práctico. Consistebásicamente en subir automáticamente las partidas guardadas a...&hellip; <a href="//elboletaire.github.io/racotecnic/2016/05/guarda-gratis-en-la-nube-tus-partidas-guardadas-o-como-hacer-copias-de-seguridad-en-la-nube-gratis/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="//elboletaire.github.io/racotecnic/2015/03/instalacion-wamp-a-pelo-con-multiples-versiones-de-php/" title="Instalación WAMP a pelo con múltiples versiones de PHP o cómo configurar Apache para correr varias versiones de PHP en distintos servidores virtuales">Instalación WAMP a pelo con múltiples versiones de PHP o cómo configurar Apache para correr varias versiones de PHP en distintos servidores virtuales</a></h4>
        <span>Published on March 16, 2015</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="//elboletaire.github.io/racotecnic/2013/12/tema-de-oh-my-zsh-inspirado-en-af-magic-y-posh-git/" title="Tema de oh my zsh inspirado en af-magic y posh-git">Tema de oh my zsh inspirado en af-magic y posh-git</a></h4>
        <span>Published on December 07, 2013</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2017 Racó Tècnic. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="//elboletaire.github.io/racotecnic/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="//elboletaire.github.io/racotecnic/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-106861877-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>



    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'racotecnic'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</body>
</html>
